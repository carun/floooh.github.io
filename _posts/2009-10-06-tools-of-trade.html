---
layout: post
title: Tools of the Trade
date: '2009-10-06T18:09:00.001+01:00'
author: Andre Weissflog
tags: 
modified_time: '2009-10-06T18:09:10.210+01:00'
thumbnail: http://lh3.ggpht.com/_cWdorEDEaNg/Sst5l4E0x6I/AAAAAAAAAII/hW_0RieEFhU/s72-c/texture_tool_thumb%5B9%5D.jpg?imgmax=800
blogger_id: tag:blogger.com,1999:blog-2948438400037317662.post-7135664494131187506
blogger_orig_url: http://flohofwoe.blogspot.com/2009/10/tools-of-trade.html
---

<p>We have ramped up tools development at Radon Labs considerably during the development of the two Drakensang games. Traditionally we have been (and still are) a bit conservative about inhouse tool development and try to avoid re-inventing wheels as much as possible. Each new custom-tool requires permanent maintenance work and if a “standard industry tool” exists for a job it is usually better to just use this. But especially in the domain of “game-logic stuff” there are basically no standard tools, so the situation is much more dire compared to graphics or audio tools. </p>  <p>We have traditionally been using Excel tables and XML files compiled into an SQLite database for “game data”. This works pretty well if the number of “work items” is around a few hundred. But for complex RPG games, the number of work items is in the range of tens-of-thousands (quest tasks, dialog takes, voice over snippets, graphics objects, textures, items, NPCs, monsters, behaviour scripts, and so on…). Excel tables and raw XML files don’t scale up very well because they lack game-specific features for filtering, searching, statistics, and of course the possibility of human error is very high, and finding and fixing those errors isn’t much fun either. </p>  <p>&#160;</p>  <h3>The Texture Tool</h3>  <p>The very first custom tool in C# (to try the waters so to say) was a simple replacement for an Excel table which defined texture attributes (stuff like the size and DXT format of a texture, mip-map quality and so on). The Excel table allowed to give each individual texture its own set of attributes. For a small project with a few hundred textures this works pretty well. Drakensang has around 15,000 textures however, and this is way beyond the territory where Excel is starting to become a pain in the ass. Thus we wrote this:</p>  <p><a href="http://lh6.ggpht.com/_cWdorEDEaNg/Sst5le21PKI/AAAAAAAAAIE/YAW7kUhuppE/s1600-h/texture_tool%5B11%5D.jpg"><img title="texture_tool" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="442" alt="texture_tool" src="http://lh3.ggpht.com/_cWdorEDEaNg/Sst5l4E0x6I/AAAAAAAAAII/hW_0RieEFhU/texture_tool_thumb%5B9%5D.jpg?imgmax=800" width="807" border="0" /></a>&#160;</p>  <p>The tool manages the same information as the Excel table it replaces, but has much better filtering and manipulation features. The left hand sides gives a tree-view of all texture categories, and it’s possible to either display all textures, or textures of a given category, and it’s also possible to further filter the textures by a pattern (for instance to display all normal textures of the “armor” category, click on “armor” in the tree view and type “*_bump.*” into the top most line of the “File” column. Entering a value into one of the other top-most column-entries will set this attribute value to all displayed textures. It’s a very simple tool, but it’s easy to use and scales up very well to tens-of-thousands of textures while still making it possible to find and tweak a single attribute of a specific texture with ease.</p>  <p>&#160;</p>  <h3>The Story Editor</h3>  <p>When we started planning Drakensang, we knew that we would need new tools for creating quests, dialogs and game logic scripting. On the surface, these 3 things are something completely different, but for the game core, quests, dialogs and scripts aren’t that different (the common element is the use of Conditions (small C++ objects which check whether some condition in the game world is true) and Actions (similar C++ objects which manipulate the game world)). Thus the Story Editor was born (actually, it’s a Dialog/Quest/Script editor). The Story Editor loads and saves XML files, which are compiled into the game database during the build process, or directly from the tool to immediately check the results in the game. We couldn’t anticipate all required features for the story editor at the start of the project, thus the editor was constantly worked on during the development of Drakensang (we added a lot of features to improve localization, proof-reading or voice-over integration for instance).</p>  <p>Note that the Story Editor currently suffers a bit from the typical “inhouse tool UI aesthetics problem” ;)</p>  <p>Here’s a screenshot of the Story Editor when working on a simple quest:</p>  <p><a href="http://lh4.ggpht.com/_cWdorEDEaNg/Sst5mfZbamI/AAAAAAAAAIM/p5oGR5bvaqA/s1600-h/story_editor_2%5B14%5D.jpg"><img title="story_editor_2" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="417" alt="story_editor_2" src="http://lh4.ggpht.com/_cWdorEDEaNg/Sst5m0ixQHI/AAAAAAAAAIQ/YG3e4YlrYVk/story_editor_2_thumb%5B12%5D.jpg?imgmax=800" width="786" border="0" /></a> </p>  <p>On the left is the simple linear task list, the panels on the right show the attributes of the currently selected task (for instance the conditions and actions associated with the task).</p>  <p>Here’s the screenshot of the Story Editor with a simple action script:</p>  <p><a href="http://lh3.ggpht.com/_cWdorEDEaNg/Sst5nHLDDHI/AAAAAAAAAIU/Fz6tNx-aMkw/s1600-h/story_editor_1%5B9%5D.jpg"><img title="story_editor_1" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="526" alt="story_editor_1" src="http://lh5.ggpht.com/_cWdorEDEaNg/Sst5ntDbpSI/AAAAAAAAAIY/LFUB0TKz0mY/story_editor_1_thumb%5B7%5D.jpg?imgmax=800" width="791" border="0" /></a> </p>  <p>We opted against a traditional scripting language, but instead used a “point and click” approach. A script is just a simple collection of Conditions and Actions. These could just as well be wrapped into LUA functions for instance. Our current approach is probably not as powerful as real scripting system, but definitely less error-prone and easier to control.</p>  <p>Finally here’s the Story Editor when working on a dialog:</p>  <p><a href="http://lh6.ggpht.com/_cWdorEDEaNg/Sst5oEJCt8I/AAAAAAAAAIc/XsmXs8R6AEU/s1600-h/story_editor_0%5B4%5D.jpg"><img title="story_editor_0" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="530" alt="story_editor_0" src="http://lh3.ggpht.com/_cWdorEDEaNg/Sst5oVMusdI/AAAAAAAAAIg/Wy3WY5y2PIc/story_editor_0_thumb%5B2%5D.jpg?imgmax=800" width="796" border="0" /></a> </p>  <p></p>  <p>Dialog takes can be associated with Conditions (to show or hide dialog takes based on some in-game condition), or Actions (to manipulate the game world as the result of a conversation). The Comment tab on the right side is most useful to add instructions for audio recording sessions.</p>  <p>&#160;</p>  <h3>The Sequence Editor</h3>  <p>In the first Drakensang, in-game cutscenes had been hand-scripted by defining a sequence of Actions in the Story Editor, basically in the most un-intuitive way imaginable. For the new Drakensang, we wrote a whole new “Sequence subsystem” along with a new tool (the Sequence Editor) which gives control over cutscenes back into the hand of the artists and provides a very intuitive workflow with instant turnaround times (resulting in a dramatic quality improvement if I may say so). Here’s a screenshot of the Sequence Editor in action on a dual-monitor setup:</p>  <p>&#160;</p>  <p><a href="http://lh4.ggpht.com/_cWdorEDEaNg/Sst5ox8xEeI/AAAAAAAAAIk/3GIYHWoIfKw/s1600-h/sequence_editor_0%5B5%5D.jpg"><img title="sequence_editor_0" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="414" alt="sequence_editor_0" src="http://lh6.ggpht.com/_cWdorEDEaNg/Sst5pEJeGaI/AAAAAAAAAIo/ANRflp0m7-k/sequence_editor_0_thumb%5B3%5D.jpg?imgmax=800" width="1028" border="0" /></a> </p>  <p>On the left-hand side is the actual editor, on the right-hand side is the ingame-preview. Tool and game communicate through XML messages over a TCP/IP connection, changes in the tool immediately show up in the preview. The other direction works as well, for instance it is possible to set keys for the camera or objects directly in the preview window, complete with snap-to-ground and other time-savers.</p>  <p>Here’s a more detailed shot of the Sequence Editor:</p>  <p><a href="http://lh4.ggpht.com/_cWdorEDEaNg/Sst5pveum9I/AAAAAAAAAIs/Sxd3CA1T_wM/s1600-h/sequence_editor_1%5B6%5D.jpg"><img title="sequence_editor_1" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="713" alt="sequence_editor_1" src="http://lh4.ggpht.com/_cWdorEDEaNg/Sst5qGNIP1I/AAAAAAAAAIw/br5aoBYjdx0/sequence_editor_1_thumb%5B4%5D.jpg?imgmax=800" width="915" border="0" /></a> </p>  <p>“Trackbar Elements” from the bottom area (Play Sound, Depth Of Field, etc…) can be drag’n’dropped into the timeline area above. Every trackbar element comes with a number of attributes, most of them can be animated over time. Trackbar attributes are displayed in the right-side column (in the screenshot, I have selected an “Ambience Bubble” element which allows to manipulate the ingame lighting, posteffect parameters, and other stuff which is important to set the visual “mood” of a scene). Animated parameters are edited in the Graph Editor which looks and feels very similar to Maya’s graph editor window:</p>  <p><a href="http://lh5.ggpht.com/_cWdorEDEaNg/Sst5qXrMlUI/AAAAAAAAAI0/VqrDE7KEz6g/s1600-h/sequence_editor_2%5B6%5D.jpg"><img title="sequence_editor_2" style="border-right: 0px; border-top: 0px; display: inline; border-left: 0px; border-bottom: 0px" height="342" alt="sequence_editor_2" src="http://lh6.ggpht.com/_cWdorEDEaNg/Sst5qzjDB6I/AAAAAAAAAI4/e6Tmxp9sREQ/sequence_editor_2_thumb%5B4%5D.jpg?imgmax=800" width="707" border="0" /></a> </p>  <p>It’s important to note that complex character animations are not created in the Sequence Editor, instead the sequence system will usually only trigger existing character animations from the character’s animation library. How complex character animation tracks are is up to the cutscene designer. Sometimes its better to fire a lot of small, generic animations and do the path-animation in the Sequence Editor, sometimes it’s better to generate one big motion-capture animation for the entire cutscene, complete with the actual character movement.</p>  <p>One very cool feature of the sequence system is its extensibility. Simple trackbar elements, like “Depth Of Field” or “Camera Shake” can be implemented in under an hour by extending an XML config file which describes the attributes of the new element to the editor tool, and by writing a very simple subclass in the engine which connects the animated values of the trackbar to another subsystem (for instance the PostEffects subsystem in case of the Depth Of Field trackbar).</p>  <p>&#160;</p>  <h3>The Table Editor</h3>  <p>The new Table Editor is aimed at finally replacing the Excel tables for game object template data. In Drakensang (or Mangalore in general) a game object’s persistent state is simply described by a collection of typed key/value-pair attributes. Different game object categories have different sets of attributes. For instance a Monster game object has a different attribute set then a Weapon game object.</p>  <p>Traditionally, we had one Excel table per game object category, and one line in the table per game-object template. The value of some of the attributes (instance attributes) can be set in the Maya level editor to a different value for each game object instance.</p>  <p>Some of the bigger game object tables became a really critical bottleneck during the production of Drakensang, since only one person could work at a table at a time. Also even though the tables were saved in XML format, both CVS and SVN are pretty much useless for merging.</p>  <p>Thus the idea was born to move the game data tables into a true database backend, and then create one generic “Table Editor” and later on, several smaller, specialized Editor tools which basically provide a different view into the database. This is also the very first step of moving away from Maya as a level editor towards a <a href="http://flohofwoe.blogspot.com/2007/10/ive-been-discussing-with-bernd-lot.html" target="_blank">truly collaborative level design environment</a>.</p>  <p>Here’s a screenshot of the generic Table Editor tool:</p>  <p><a href="http://lh3.ggpht.com/_cWdorEDEaNg/Sst5rEMjsCI/AAAAAAAAAI8/lAe-C1BtNqY/s1600-h/db_frontend%5B29%5D.jpg"><img title="db_frontend" style="border-right: 0px; border-top: 0px; display: inline; border-left: 0px; border-bottom: 0px" height="588" alt="db_frontend" src="http://lh3.ggpht.com/_cWdorEDEaNg/Sst5rs_t1UI/AAAAAAAAAJA/xdjAbXt13SU/db_frontend_thumb%5B23%5D.jpg?imgmax=800" width="912" border="0" /></a> </p>  <p>On first glance, this just looks like a nifty Excel replacement, but under the hood it is much more:</p>  <p>There’s a complete user system with login and access rights (in the screenshot above, I can see that I am currently logged in as “floh”, and that 1 other user is currently editing the Weapon-Table).</p>  <p>Then there’s a complete revision control system. The table basically extends into the time dimension, and it’s possible to inspect the table at any point in the past. There’s also a very detailed change-log, which not only tells me who modified the table at what time, but also all the changes made to the table:</p>  <p><a href="http://lh3.ggpht.com/_cWdorEDEaNg/Sst5sA0PjqI/AAAAAAAAAJE/5GQOBKkluvo/s1600-h/db_editor_changelog%5B5%5D.jpg"><img title="db_editor_changelog" style="border-right: 0px; border-top: 0px; display: inline; border-left: 0px; border-bottom: 0px" height="442" alt="db_editor_changelog" src="http://lh5.ggpht.com/_cWdorEDEaNg/Sst5sclMsuI/AAAAAAAAAJI/o7gMzq0IIxM/db_editor_changelog_thumb%5B3%5D.jpg?imgmax=800" width="742" border="0" /></a> </p>  <p>Of course it’s also possible to revert the content of any cell to any point in time.</p>  <p>When a level designer changes values in a table, it will only happen in a local sandbox (the changed values already live in the central database, but are marked as local data of the user). This allows a level designer to mess around with the tables without affecting the other users. When everything works as expected, the changes are committed into the “global domain” and the new values are visible to all.</p>  <p>The generic database table editor tool is very powerful, but the whole system really shines with specialized front-end editors like this:</p>  <p><a href="http://lh5.ggpht.com/_cWdorEDEaNg/Sst5s-_2YUI/AAAAAAAAAJM/DX5BucAbvLU/s1600-h/db_special_frontend%5B4%5D.jpg"><img title="db_special_frontend" style="border-right: 0px; border-top: 0px; display: inline; border-left: 0px; border-bottom: 0px" height="552" alt="db_special_frontend" src="http://lh4.ggpht.com/_cWdorEDEaNg/Sst5tL5cRRI/AAAAAAAAAJQ/cJDlBP5MTmQ/db_special_frontend_thumb%5B2%5D.jpg?imgmax=800" width="845" border="0" /></a> </p>  <p>This is basically just a different frontend to the global game database with a specialized GUI for efficiently equipping characters and chests in the game. The general idea here is that such a specialized editor tool is written for tasks where working with the generic editor is not desirable because it would be too cumbersome, un-intuitive or error-prone.</p>  <p>There’s also a lot of interesting work going on in our build-pipeline at the moment, but I’ll leave this to another post :)</p>  