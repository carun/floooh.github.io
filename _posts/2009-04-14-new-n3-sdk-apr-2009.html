---
layout: post
title: New N3 SDK (Apr 2009)
date: '2009-04-14T19:03:00.001+01:00'
author: Andre Weissflog
tags: 
modified_time: '2009-04-14T19:16:57.538+01:00'
thumbnail: http://lh4.ggpht.com/_cWdorEDEaNg/SeTP6v7Fk_I/AAAAAAAAAHE/qHHcRb8olKo/s72-c/foundation_layer_thumb%5B6%5D.gif?imgmax=800
blogger_id: tag:blogger.com,1999:blog-2948438400037317662.post-6994811407489212567
blogger_orig_url: http://flohofwoe.blogspot.com/2009/04/new-n3-sdk-apr-2009.html
---

<p>The new SDK release should be ready by tomorrow (unless there's some last-minute fuckup). For now here's a rough What's New list since the last SDK from September 2008:</p>  <h5>Tools:</h5>  <ul>   <li>new command line tool: archiver3 - multiplatform wrapper for generating file archives</li>    <li>new command line tool: n2converter3 - convert .n2 files to .n3 files (Nebula graphics objects)</li>    <li>new command line tool: suiconverter3 - batch converter for SUI resources (simple user interface), currently only useful for the Wii port</li>    <li>new command line tool: synctool3 - sync local project directory from build server (only useful with our inhouse asset pipeline)</li>    <li>new command line tool: countlines3 - count N3 source code lines and generate Excel-compatible csv-file (comma separated values)</li> </ul>  <h5></h5>  <h5>Foundation Layer:</h5>  <ul>   <li>brought Wii port uptodate (not part of the public SDK of course)</li>    <li>Util::CmdLineArgs renamed to Util::CommandLineArgs</li>    <li>Scripting subsystem moved into an addon</li>    <li>Remote subsystem moved into an addon</li>    <li>new Macros __ConstructInterfaceSingleton / __DestructInterfaceSingleton</li>    <li>new standard define __MAYA__ if compiled as part of a Maya plugin</li>    <li>new concept: ExitHandlers (see Core::ExitHandler)</li>    <li>new low level debug feedback method Core::SysFunc::MessageBox()</li>    <li>new concept &quot;root directory&quot; (see CoreServer::SetRootDirectory)</li>    <li>various changes to enable using N3 code in N2/Mangalore apps (N2 now sits on top of a very slim N3 Foundation layer)</li>    <li>SizeT and IndexT now signed (had to be done for N2/Mangalore compatibility unfortunately)</li>    <li>IO::Console is now an InterfaceSingleton</li>    <li>various debug HTML page handlers can now sort table content by columns</li>    <li>Debug::DebugServer is now an InterfaceSingleton</li>    <li>added a minimal Debug::HelloWorldRequestHandler as example for a simple HttpRequestHandler</li>    <li>new comfort method Http::HtmlPageWriter::TableRow2(), saves code when creating a 2-column HTML table</li>    <li>added Http::HttpClient class, allows send requests to HTTP servers</li>    <li>Http::HttpInterface is now an InterfaceSingleton and derived from Interface::InterfaceBase</li>    <li>new class Http::HttpRequestWriter</li>    <li>new class Http::HttpResponseReader</li>    <li>added a &quot;single thread mode&quot; to HttpServer</li>    <li>added new classes InterfaceBase and InterfaceHandlerBase</li>    <li>moved IOInterface-stuff under IO</li>    <li>new class Debug::ConsolePageHandler, displays console output in web server</li>    <li>generalized Zip filesystem stuff into general archive filesystem, with ZIP support as one specialization (on Wii, ARC files are used instead)</li>    <li>ZipFileSystem is now an InterfaceSingleton (no more per-thread wasted memory for archive table-of-contents)</li>    <li>added an &quot;AsString()&quot; method to IO::FileTime</li>    <li>new methods in Win360FSWrapper: SetFileWriteTime(), GetAppDataDirectory(), GetProgramsDirectory()</li>    <li>moved IO::ZipFileStream class to io/zipfs</li>    <li>moved path assign methods from IoServer into new InterfaceSingleton: IO::AssignRegistry</li>    <li>new standard assigns under Windows: &quot;appdata&quot; and &quot;programs&quot;, mainly useful for tools</li>    <li>bugfix in IO::ExcelXmlReader for tables with empty cells</li>    <li>new class IO::HistoryConsoleHandler, captures console output into a ring buffer (used by Debug::ConsolePageHandler)</li>    <li>moved URI scheme methods from IoServer into IO::SchemeRegistry InterfaceSingleton</li>    <li>removed critical section from Stream::Open / Stream::Close</li>    <li>new method: IO::XmlWriter::WriteComment()</li>    <li>new methods specialized float4-loading methods: Math::float4::load_float3(), Math::float4::load_ubyte4n_signed()</li>    <li>vector comparison methods in Math::float4 more intuitive and flexible</li>    <li>Math::matrix44() default constructor now sets object to the identity matrix (default constructor still empty in Math::float4!)</li>    <li>new constructor from float4 in Math::quaternion</li>    <li>moved lots of math functions from scalar.h to platform-specific d3dx9_scalar.h to enable platform-specific optimizations</li>    <li>Memory::Heap constructor now accepts initial and maximum heap size</li>    <li>memory leap detection for Memory::Heap (doesn't quite work as expected yet)</li>    <li>removed global heaps: SmallBlockHeap, LargeBlockHeap, StringHeap</li>    <li>added global heaps: PhysicsHeap, AppHeap, StringObjectHeap, StringDataHeap</li>    <li>new experimental Win360MemoryPoolClass </li>    <li>Messaging::AsyncPort: can now add message handlers to already opened ports</li>    <li>added &quot;deferred handled&quot; flag to Messaging::Message (used in the rendering thread to keep CreateEntity messages around until their resources are loaded)</li>    <li>wrapped socket and TCP/IP classes to enable &quot;TCP/IP-over-HIO2-Tunneling&quot; on the Wii</li>    <li>System::Win32Registry(): split Read() method into ReadString() and ReadInt()</li>    <li>System::ByteOrder::Convert&lt;TYPE&gt;() methods now return a value, added new methods System::ByteOrder::ConvertInPlace&lt;TYPE&gt;()</li>    <li>new methods Threading::Interlocked::Exchange() and CompareExchange()</li>    <li>Win360Thread::IsRunning() now uses the Win32 function GetExitCodeThread() to detect whether the thread is running</li>    <li>new method Threading::Thread::YieldThread() (gives up time-slice)</li>    <li>new class Threading::SafeFlag</li>    <li>new concept: Timing::MasterTime and Timing::SlaveTime, main thread has a MasterTime object, and distributes &quot;main time&quot; to slave threads (i.e. the render thread)</li>    <li>Util::Array now has a MinGrowSize and MaxGrowSize to prevent excessive memory waste for huge arrays</li>    <li>new experimental class Util::Delegate (doesn't work in Codewarrior unfortunately)</li>    <li>new method Util::FixedArray::AsArray()</li>    <li>new methods Util::Dictionary::KeysAs&lt;TYPE&gt;(), and Util::Dictionary::ValuesAs&lt;TYPE&gt;()</li>    <li>new class Util::PriorityArray (which actually isn't needed anymore I think)</li>    <li>new class Util::RandomNumberTable</li>    <li>new class Util::Round</li>    <li>made many non-essential Util::String methods non-inline </li> </ul>  <h5>Render Layer</h5>  <ul>   <li>new Character subsystem (modular character rendering, fresh rewrite of N2's Character3 system)</li>    <li>new CoreFX subsystem (ported from Mangalore's VFX subsystem (visual effects)) -&gt; NOTE: will be moved into addon</li>    <li>new CoreUI and UI subsystems (simple user interface system) -&gt; NOTE: will be moved into addon </li>    <li>new Video subsystem (video playback, currently Xbox360 only) -&gt; NOTE: will be moved into addon</li>    <li>new Particles subsystem (rewritten from scratch) -&gt; NOTE: will be moved into addon</li>    <li>new PostEffect subsystem (ported from Mangalore) -&gt; NOTE: will be moved into addon</li>    <li>new Vibration subsystem (game pad vibration support) -&gt; NOTE: will be moved into addon</li>    <li>new Vegetation subsystem (Drakensang's grass renderer, currently broken under N3) -&gt; NOTE: will be moved into addon</li>    <li>new concept: RenderModules, clean framework to add functionality to the render thread</li>    <li>new concept: AnimEvents, animations can emit events at certain sample times (i.e. for playing foot-step sounds at the right time)</li>    <li>new concept: character attachments (swords, etc...)</li>    <li>lots of bugfixes and improvements to Animation system</li>    <li>new concept: AnimDrivenMotion, synchronize character movement with its current animation</li>    <li>new concept: batched messages, drastically reduce communication overhead between threads by client-side batching of messages</li>    <li>new methods: Audio::AudioEmitter::Pause() and Resume()</li>    <li>new methods: AudioDevice::SetGlobalVariable() / GetGlobalVariable()</li>    <li>added/fixed Xbox360 support to XACT audio classes</li>    <li>new class: MultipleRenderTarget, wraps MRT rendering</li>    <li>new class: MouseRenderDevice (currently only implemented on Wii)</li>    <li>added support for GPU-instanced-rendering </li>    <li>RenderTarget: added support to resolve depth buffer into texture (Xbox360 only)</li>    <li>RenderTarget: added support to create a resolve-texture which can be efficiently read by the CPU</li>    <li>added &quot;late-binding&quot; to ShaderVariableInstance</li>    <li>D3D9StreamTextureLoader and D3D9Texture moved from win360 to d3d9, since specialized Xbox360 versions exist now</li>    <li>Debug::MeshPageHandler can now display a dump of the vertex data in the web browser</li>    <li>Debug::TexturePageHandler now displays the current resource state of textures (Initial, Pending, Loaded, etc...)</li>    <li>new class CoreGraphics::MemoryMeshLoader</li>    <li>renamed CoreGraphics::Shape to CoreGraphics::RenderShape (because of CodeWarrior problems with identical filenames in different directories)</li>    <li>added Multiple Render Target support to Frame::FramePass and Frame::FramePostEffect</li>    <li>Graphics::Display::GetDisplayMode() now returns display mode actually set by the CoreGraphics::DisplayDevice (may differ from the requested display mode)</li>    <li>Graphics::GlobalLightEntity: all light parameter changes are now transferred to the render-thread-side post-creation</li>    <li>Graphics::GraphicsEntity: internal entity handle now only becomes valid after resources have been loaded on the render-thread-side</li>    <li>Graphics::GraphicsInterface now uses batch messaging to communicate with render-thread (only 1 message sent per frame)</li>    <li>Graphics::Handle is now a smart pointer (fixes problems where render-thread graphics entities were disposed too early)</li>    <li>Graphics::ModelEntity: support for AnimDrivenMotion</li>    <li>new Input::GamePad methods: ButtonAsString(), AxisAsString(), GetStateAsInputEvents()</li>    <li>InternalGraphicsEntities are now registered with the InternalGraphicsServer</li>    <li>lots of changes in InternalGraphicsServer and InternalModelEntity which require a proper cleanup doh</li>    <li>added support for 2-sided lighting to global lights</li>    <li>new classes: Models::AnimatorNode and Models::AnimatorNodeInstance (legacy Nebula2 stuff)</li>    <li>new classes: Models::CharacterNode and Models::CharacterNodeInstance, integrate character rendering with model nodes</li>    <li>loading of ModelNodes completely rewritten (new .n3 file format, plus n2converter3 tool to convert .n2 files to .n3)</li>    <li>new Model::OnResourcesLoaded() method, if Model subclasses need to do initialization work after resources have finished loading</li>    <li>new methods to lookup ModelNodeInstances on ModelInstances</li>    <li>new class Models::StreamModelLoader</li>    <li>lots of other minor changes in namespace Models</li>    <li>new class: RenderUtil::MouseRayUtil, convert 2D mouse position into world-space 3D-ray</li>    <li>new method: ResourceManager::CheckPendingResources(), returns true when there are currently no pending resources waiting to be loaded</li>    <li>SharedResourceServer: several methods now accept a ResourceLoader object when creating shared resources </li> </ul>  <p>I also did some interesting line counting statistics recently for the Foundation and Render layers (hopefully the images won't be scaled down too much):</p>  <p><a href="http://lh4.ggpht.com/_cWdorEDEaNg/SeTTFLBjBtI/AAAAAAAAAHA/MItj3LLpJC0/s1600-h/foundation_layer%5B8%5D.gif"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="416" alt="foundation_layer" src="http://lh4.ggpht.com/_cWdorEDEaNg/SeTP6v7Fk_I/AAAAAAAAAHE/qHHcRb8olKo/foundation_layer_thumb%5B6%5D.gif?imgmax=800" width="640" border="0" /></a>&#160;</p>  <p><a href="http://lh5.ggpht.com/_cWdorEDEaNg/SeTP60dpOdI/AAAAAAAAAHI/MJGdhnZwcTY/s1600-h/render_layer%5B5%5D.gif"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="416" alt="render_layer" src="http://lh4.ggpht.com/_cWdorEDEaNg/SeTP7nA18oI/AAAAAAAAAHM/izdjQMhBAbw/render_layer_thumb%5B3%5D.gif?imgmax=800" width="640" border="0" /></a>&#160;</p>  <p>&quot;General&quot; is the platform-agnostic code, which is the same for all platforms, &quot;Win360&quot; is the code which is identical between Win32 and Xbox360. </p>  